<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Prospect Bookstore</title>
    <link rel="shortcut icon" href="http://i.imgur.com/iJx6I7Y.png" type="image/x-icon">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="css/index.css?v=4" />
    <link rel="stylesheet" type="text/css" href="css/starability-fade.min.css" />
    <style>

        /* Top Header Styles */
        .top-header {
            background: linear-gradient(135deg, white 75%, #A33F5B 75%, #A33F5B 90%, #821934 90%);
            padding: 0;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden; /* Important for clean edges */
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            width: 100%;
        }

        .brand-name {
            font-size: 24px;
            font-weight: bold;
            color: #343a40;
        }






        /* Bottom Footer Styles */
        .social-footer {
            background-color: #821934;
            color: white;
            padding: 30px 0;
            margin-top: 50px;
            width: 100%;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 25px;
        }

        .social-icon {
            color: white;
            font-size: 28px;
            transition: all 0.3s;
        }

        .social-icon:hover {
            transform: scale(1.2);
            color: #f8f9fa;
        }

        .footer-text {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            opacity: 0.8;
        }






        /* Style for Best sellers & recommendations */
        .books-heading {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #343a40;
            text-align: center;
            margin: 2rem 0;
            position: relative;
        }

        .books-heading::after {
            content: '';
            display: block;
            width: 60px;
            height: 4px;
            background-color: #821934;
            margin: 0.5rem auto 0;
            border-radius: 2px;
        }






        /* Style for the logo */
        .resized-img {
            width: 240px;
            height: auto;   /* this keeps the original aspect ratio */
            display: block; /* optional: removes any extra space */
        }





        /* Για το κουμπί της σύνδεσης και εγγραφής for the logo */
        .btn-outline-primary,
        .btn-outline-secondary {
            color: #ffffff; /* White text for both buttons */
            background-color: transparent; /* Initially transparent background */
            border: 1px solid transparent; /* No border initially (transparent border) */
            transition: all 0.3s ease; /* Smooth transition for hover effects */
        }

        .btn-outline-primary:hover,
        .btn-outline-secondary:hover {
            color: #ffffff; /* Keep text white on hover */
            background-color: #4d0d21; /* Fill with a darker purple on hover */
            border-color: #4d0d21; /* Border appears and matches fill color on hover */
        }




        body {
            background-color: #E9ECEF; /* Λίγο πιο γκρι από αυτό του bootstrap */
        }





        /* Για την αναζήτηση κάποια έξτρα */
        .position-relative {
            position: relative;
        }

        .input-group-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            pointer-events: none;
            color: #0d6efd;
        }

        #searchQuery {
            padding-left: 45px;
            padding-right: 15px;
            border-radius: 50px !important;
        }


























    </style>
</head>
<body>



<div style="background-color: #333; color: #fff; padding: 8px 0; text-align: center; font-size: 14px;">
    <span style="margin: 0 15px;">Εύκολες πληρωμές</span>
    <span style="margin: 0 15px;">Με αντικαταβολή και κάρτα</span>
    <span style="margin: 0 15px;">Τηλεφωνικές Παραγγελίες 10:00-17:00</span>
</div>


<!-- Top Header -->
<header class="top-header">
    <div class="header-content d-flex justify-content-between align-items-center">
        <img src="https://i.imgur.com/Ksq7tEh.png" alt="Our logo" class="resized-img">

        <div class="flex-grow-1 d-flex justify-content-center">
            <div class="col-md-8 col-lg-6"> <form id="searchForm" role="search">
                <div class="position-relative">
                    <input
                            type="search"
                            id="searchQuery"
                            name="q"
                            class="form-control rounded-pill border-primary"
                            placeholder="Τι ψάχνεις σήμερα;"
                            aria-label="Search"
                            required
                    >
                    <span class="input-group-icon" id="searchButton">
                            <i class="bi bi bi-search text-primary"></i>
                        </span>
                </div>
            </form>
            </div>
        </div>

        <div class="d-flex gap-2">
            <a href="registration.html" class="btn btn-outline-primary">Εγγραφή</a>
            <a href="login.html" class="btn btn-outline-secondary">Σύνδεση</a>
        </div>
    </div>
    </div>
</header>





<div class="container mt-5">
    <h1 class="books-heading">Κορυφαία σε πωλήσεις &amp; Προτάσεις</h1>
    <div id="bookCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <!-- Books will be inserted here -->
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#bookCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#bookCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</div>

<!-- Book Detail Modal -->
<div class="modal fade" id="bookDetailModal" tabindex="-1" aria-labelledby="bookDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bookDetailModalLabel">Book Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Left: Book Details -->
                    <div class="col-md-6 pe-md-4 border-end" style="max-height: 70vh; overflow-y: auto;">
                        <div class="text-center mb-3">
                            <img id="bookDetailImage" src="" alt="" class="book-detail-image img-fluid" style="max-height: 200px;">
                        </div>
                        <h3 id="bookDetailTitle" class="text-center mb-2"></h3>
                        <h5 id="bookDetailAuthor" class="text-center mb-4"></h5>

                        <div class="row">
                            <div class="col-md-6">
                                <p class="book-meta"><strong>Publisher:</strong> <span id="bookDetailPublisher"></span></p>
                                <p class="book-meta"><strong>Published Date:</strong> <span id="bookDetailPublishedDate"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p class="book-meta"><strong>Page Count:</strong> <span id="bookDetailPageCount"></span></p>
                                <p class="book-meta"><strong>Genres:</strong> <span id="bookDetailGenres"></span></p>
                            </div>
                        </div>

                        <div class="text-center mt-3">
                            <a id="bookDetailPreviewLink" href="#" target="_blank" class="btn btn-primary book-preview-link">Preview Book</a>
                        </div>

                        <div id="bookDetailDescription" class="book-description mt-3"></div>


                    </div>
                    <div class="col-md-6 ps-md-4" style="max-height: 70vh; overflow-y: auto;">
                        <div class="mt-5 mb-5 ">
                            <h4 class="mb-3">Add the book to your cart!</h4>
                            <p class="book-meta"><strong>Price:</strong> <span id="bookDetailPrice"></span><strong>€      </strong><strong>Stock:</strong> <span id="bookDetailStock"></span></p>
                            <button class="btn btn-success mb-4 mt-3">Add to Cart!</button>
                        </div>
                        <h4>Leave your rating and comment here!</h4>
                        <form id="commentForm" class="mb-3 validated-form" novalidate>
                            <input type="hidden" id="bookDetailIsbn" name="isbn" value="">
                            <div class="mb-3">
                                <label class="form-label">Your Rating:</label>
                                <fieldset class="starability-fade">
                                    <input type="radio" id="rate5" name="rating" value="5" />
                                    <label for="rate5" title="Amazing">5 stars</label>

                                    <input type="radio" id="rate4" name="rating" value="4" />
                                    <label for="rate4" title="Very good">4 stars</label>

                                    <input type="radio" id="rate3" name="rating" value="3" />
                                    <label for="rate3" title="Average">3 stars</label>

                                    <input type="radio" id="rate2" name="rating" value="2" />
                                    <label for="rate2" title="Not good">2 stars</label>

                                    <input type="radio" id="rate1" name="rating" value="1" required />
                                    <label for="rate1" title="Terrible">1 star</label>
                                </fieldset>
                                <div class="invalid-feedback" id="rating-error" style="display: none;">
                                    Please select a rating.
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="comment">Comment: </label>
                                <textarea class="form-control" name="comment" id="comment" rows="3" required></textarea>
                            </div>
                            <button class="btn btn-success mb-4">Submit</button>
                        </form>

                        <h5>User Reviews:</h5>
                        <div id="commentsContainer">
                            <!-- Example comment cards -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Rating:</h5>
                                    <div class="text-warning">
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-half"></i>
                                        <i class="bi bi-star"></i>
                                    </div>
                                    <p class="card-title">by user1</p>
                                    <p class="card-text">This is a comment.</p>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Rating:</h5>
                                    <div class="text-warning">
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                        <i class="bi bi-star-fill"></i>
                                    </div>
                                    <p class="card-title">by user2</p>
                                    <p class="card-text">Another comment.</p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Bottom Footer with Social Media Icons -->
<footer class="social-footer">
    <div class="container">
        <div class="social-icons">
            <a href="https://www.instagram.com" target="_blank" class="social-icon">
                <i class="bi bi-instagram"></i>
            </a>
            <a href="https://www.twitter.com" target="_blank" class="social-icon">
                <i class="bi bi-twitter"></i>
            </a>
            <a href="https://www.facebook.com" target="_blank" class="social-icon">
                <i class="bi bi-facebook"></i>
            </a>
            <a href="https://www.tiktok.com" target="_blank" class="social-icon">
                <i class="bi bi-tiktok"></i>
            </a>
            <a href="https://www.linkedin.com" target="_blank" class="social-icon">
                <i class="bi bi-linkedin"></i>
            </a>
        </div>
        <div class="footer-text">
            © 2025 Prospect BookStore. All rights reserved.
        </div>
    </div>
</footer>

<!-- Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Book detail modal instance
    let bookDetailModal;

    // Function to fetch books from our backend API
    async function fetchBooks(query = 'bestsellers') {
        try {
            const response = await fetch(`/api/books/search?query=${encodeURIComponent(query)}`);
            const books = await response.json();
            return books || [];
        } catch (error) {
            console.error('Error fetching books:', error);
            return [];
        }
    }

    // Function to create carousel items
    function createCarouselItems(books) {
        const carouselInner = document.querySelector('.carousel-inner');
        carouselInner.innerHTML = '';

        // Ensure books is an array and filter out null/undefined books
        const validBooks = Array.isArray(books) ? books.filter(book => book !== null && book !== undefined) : [];

        if (validBooks.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'carousel-item active';
            emptyMessage.innerHTML = `
            <div class="d-flex justify-content-center align-items-center h-100">
                <h3>Δεν βρέθηκαν αποτελέσματα. Δοκιμάστε έναν διαφορετικό τίτλο.</h3>
            </div>
        `;
            carouselInner.appendChild(emptyMessage);
            return;
        }

        // Chunk books into groups of 3
        for (let i = 0; i < validBooks.length; i += 3) {
            const slideBooks = validBooks.slice(i, i + 3);
            const carouselItem = document.createElement('div');
            carouselItem.className = `carousel-item ${i === 0 ? 'active' : ''}`;

            const row = document.createElement('div');
            row.className = 'row justify-content-center';

            slideBooks.forEach(book => {
                // Extra safety check
                if (!book) return;

                const col = document.createElement('div');
                // Use col-md-4 to show up to 3 in a row, center fewer items
                col.className = `col-12 col-sm-6 col-md-4 d-flex align-items-stretch`;

                col.innerHTML = `
                <div class="card w-100 h-100 book-slide" style="cursor:pointer;">
                    <img src="${book.imageUrl || ''}" class="card-img-top" alt="${book.title || 'Book'}">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${book.title || 'Unknown Title'}</h5>
                        <p class="card-text text-muted">by ${book.authorUsername || 'Unknown Author'}</p>
                        <div class="mt-auto text-end">
                            <span class="text-primary fw-bold">€${book.price || '0'}</span>
                        </div>
                    </div>
                </div>
            `;

                // Click to open modal
                col.querySelector('.book-slide').addEventListener('click', () => openBookDetail(book));

                row.appendChild(col);
            });

            carouselItem.appendChild(row);
            carouselInner.appendChild(carouselItem);
        }
    }


    // Function to open book detail modal
    function openBookDetail(book) {
        // Safety check for null or undefined book
        if (!book) {
            console.error('Error: Attempted to open detail modal with null or undefined book');
            return;
        }




        try {

             const form = document.getElementById('commentForm');
            form.reset();
            form.classList.remove('was-validated');
            document.getElementById('rating-error').style.display = 'none';



            // Safely set modal content with null checks for each element
            const elements = {
                'bookDetailModalLabel': book.title || 'Unknown Title',
                'bookDetailTitle': book.title || 'Unknown Title',
                'bookDetailAuthor': `by ${book.authorUsername || 'Unknown Author'}`,
                'bookDetailPublisher': book.publisher || 'Unknown',
                'bookDetailPublishedDate': book.publishedDate || 'Unknown',
                'bookDetailPageCount': book.pageCount ? `${book.pageCount} pages` : 'Unknown',
                'bookDetailGenres': book.genre || 'Unknown',
                'bookDetailPrice': book.price || '0',
                'bookDetailStock': book.stock || 'Unknown',
                'bookDetailDescription': book.description || 'No description available'
            };
    
            // Set text content for each element
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) {
                    if (id === 'bookDetailDescription') {
                        element.innerHTML = value;
                    } else {
                        element.textContent = value;
                    }
                }
            }
    
            // Handle image separately
            const imageElement = document.getElementById('bookDetailImage');
            if (imageElement) {
                imageElement.src = book.imageUrl || '';
                imageElement.alt = book.title || 'Book';
            }
    
            // Handle ISBN value separately
            const isbnElement = document.getElementById('bookDetailIsbn');
            if (isbnElement) {
                isbnElement.value = book.isbn || 'Unknown';
            }
    
            // Handle preview link separately
            const previewLink = document.getElementById('bookDetailPreviewLink');
            if (previewLink) {
                if (book.previewLink) {
                    previewLink.href = book.previewLink;
                    previewLink.style.display = 'inline-block';
                } else {
                    previewLink.style.display = 'none';
                }
            }
    
            // Refresh comments if ISBN is available
            if (book.isbn) {
                refreshComments(book.isbn);
            }
    
            // Show the modal
            if (bookDetailModal) {
                bookDetailModal.show();
            } else {
                console.error('Modal instance not initialized');
            }
        } catch (error) {
            console.error('Error opening book detail modal:', error);
        }
    }

    // Initialize the carousel with books
    async function initializeCarousel() {
        const books = await fetchBooks();
        createCarouselItems(books);
    }

    // Handle search form submission
    document.getElementById('searchForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const query = document.getElementById('searchQuery').value.trim();
        if (query) {
            const books = await fetchBooks(query);
            createCarouselItems(books);
        }
    });

    // Handle search icon click
    document.getElementById('searchButton').addEventListener('click',async function(event) {
        event.preventDefault();
        const searchForm = document.getElementById('searchForm');
        const searchQuery = document.getElementById('searchQuery').value.trim();

        if (searchQuery) {
            const books = await fetchBooks(searchQuery);
            createCarouselItems(books);
        }
    });

    // Initialize everything when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize the modal
        bookDetailModal = new bootstrap.Modal(document.getElementById('bookDetailModal'));
        const urlParams = new URLSearchParams(window.location.search);
        const initialQuery = urlParams.get('q') || 'bestsellers';
        // Load books with an initial query
        fetchBooks(initialQuery).then(createCarouselItems);
    });




(function () {
  'use strict'


  var forms = document.querySelectorAll('.validated-form')

  // Loop over them and prevent submission
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })
})()




document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('.validated-form');
    if (form) {
        const ratingInputs = form.querySelectorAll('input[name="rating"]');
        const ratingError = document.getElementById('rating-error');

        if (ratingInputs && ratingError) {
            ratingInputs.forEach(input => {
                input.addEventListener('change', () => {
                    if (input.checked) {
                        ratingError.style.display = 'none';
                    }
                });
            });

            form.addEventListener('submit', function (event) {
                let ratingValid = Array.from(ratingInputs).some(input => input.checked);

                if (!ratingValid) {
                    event.preventDefault();
                    event.stopPropagation();
                    ratingError.style.display = 'block';
                } else {
                    ratingError.style.display = 'none';
                }

                form.classList.add('was-validated');
            });
        }
    }
});

// Add event listener only if commentForm exists
document.addEventListener('DOMContentLoaded', function() {
    const commentForm = document.getElementById('commentForm');
    if (commentForm) {
        commentForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const form = e.target;

             if (!form.checkValidity()) {
                form.classList.add('was-validated'); // show Bootstrap styles
                return;
                 }

                const ratingInputs = form.querySelectorAll('input[name="rating"]');
                const ratingError = document.getElementById('rating-error');
                const ratingValid = Array.from(ratingInputs).some(input => input.checked);

                if (!ratingValid) {
                ratingError.style.display = 'block';
                return;
                } else {
                ratingError.style.display = 'none';
                }


                 const formData = new FormData(form);

            try {
                const response = await fetch('/comment/save', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    form.reset();
                    form.classList.remove('was-validated');
                    const ratingError = document.getElementById('rating-error');
                    if (ratingError) {
                        ratingError.style.display = 'none';
                    }

                    const isbn = document.getElementById("bookDetailIsbn").value;
                    if (isbn) {
                        refreshComments(isbn);
                    }
                }
            } catch (err) {
                console.error('Submission error:', err);
            }
        });
    }
});


function refreshComments(isbn) {
    if (!isbn) {
        console.error('Cannot refresh comments: No ISBN provided');
        return;
    }
    
    fetch(`/comments?isbn=${encodeURIComponent(isbn)}`)
        .then(response => response.json())
        .then(comments => {
            const container = document.getElementById('commentsContainer');
            if (!container) {
                console.error('Comments container not found');
                return;
            }
            
            container.innerHTML = ''; // Clear old comments

            if (!comments || comments.length === 0) {
                container.innerHTML = '<p>No comments yet.</p>';
                return;
            }

            comments.forEach(comment => {
                const div = document.createElement('div');
                div.className = 'comment border rounded p-3 mb-3';

                const fullStars = Math.floor(comment.rating || 0);
                const emptyStars = 5 - fullStars;

                let starsHtml = '';
                for (let i = 0; i < fullStars; i++) {
                    starsHtml += '<i class="bi bi-star-fill"></i>';
                }
                for (let i = 0; i < emptyStars; i++) {
                    starsHtml += '<i class="bi bi-star"></i>';
                }

                div.innerHTML = `
                    <div class="d-flex align-items-center gap-2 mb-1">
                        <h6 class="mb-0">${comment.username || 'Anonymous'}</h6>
                        <div class="text-warning">${starsHtml}</div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">${comment.dateCreated ? new Date(comment.dateCreated).toLocaleDateString() : 'Unknown date'}</small>
                    </div>
                    <p class="mb-0">${comment.content || ''}</p>
                `;

                container.appendChild(div);
            });
        })
        .catch(error => {
            console.error('Failed to load comments:', error);
        });
}




</script>
</body>
</html>